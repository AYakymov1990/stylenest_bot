# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–æ—Ç–∞ - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

## –û–±–∑–æ—Ä —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### 1. –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ (`app/tasks/expiry.py`)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∏—Å—Ç–µ–∫–ª–∏ (`ends_at <= now`)
- –£–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –∫–∞–Ω–∞–ª–∞ —á–µ—Ä–µ–∑ ban/unban
- –ü–æ–º–µ—á–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –∫–∞–∫ `expired` –≤ –ë–î
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏

**–õ–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:**
```python
# –°–Ω–∞—á–∞–ª–∞ –±–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
await bot.ban_chat_member(chat_id=settings.CHANNEL_ID, user_id=user_id)
# –ó–∞—Ç–µ–º —Ä–∞–∑–±–∞–Ω–∏–≤–∞–µ—Ç (—ç—Ç–æ —É–¥–∞–ª—è–µ—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞)
await bot.unban_chat_member(chat_id=settings.CHANNEL_ID, user_id=user_id, only_if_banned=True)
```

**–õ–æ–≥–∏:**
- `[EXPIRY] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ {–≤—Ä–µ–º—è}`
- `[EXPIRY] –ù–∞–π–¥–µ–Ω–æ {–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ} –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫`
- `[EXPIRY] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ {id} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {tg_id}`
- `[EXPIRY] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {tg_id} —É–¥–∞–ª–µ–Ω –∏–∑ –∫–∞–Ω–∞–ª–∞`
- `[EXPIRY] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {tg_id}`

### 2. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏—Ö—Å—è –ø–æ–¥–ø–∏—Å–∫–∞—Ö (`app/tasks/reminders.py`)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 3 –¥–Ω—è –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 1 –¥–µ–Ω—å –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

**–õ–æ–≥–∏–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:**
```python
# –ó–∞ 3 –¥–Ω—è: ends_at –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ (now+3d, now+3d+1h)
# –ó–∞ 1 –¥–µ–Ω—å: ends_at –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ (now+1d, now+1d+1h)
# –¢–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫, –∫–æ—Ç–æ—Ä—ã–º –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
```

**–õ–æ–≥–∏:**
- `[REMINDERS] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –Ω–∞ {–≤—Ä–µ–º—è}`
- `[REMINDERS] –ù–∞–π–¥–µ–Ω–æ {–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ} –ø–æ–¥–ø–∏—Å–æ–∫ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 3 –¥–Ω—è`
- `[REMINDERS] –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 3 –¥–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {tg_id}`
- `[REMINDERS] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {tg_id}`

### 3. Worker (`app/tasks/worker.py`)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ü–∏–∫–ª—ã reminders –∏ expiry –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç Telegram updates
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–õ–æ–≥–∏:**
- `[WORKER] –ó–∞–ø—É—Å–∫ worker'–∞`
- `[WORKER] –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π`
- `[WORKER] –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫`
- `[WORKER] –í—Å–µ –∑–∞–¥–∞—á–∏ –∑–∞–ø—É—â–µ–Ω—ã: polling, reminders, expiry, winback`

## –§–∞–π–ª—ã –ª–æ–≥–æ–≤

- `logs/bot.log` - –æ–±—â–∏–µ –ª–æ–≥–∏ –±–æ—Ç–∞
- `logs/tasks.log` - –ª–æ–≥–∏ –∑–∞–¥–∞—á (reminders, expiry, winback, worker)

### 5. –í–µ–±-–¥–∞—à–±–æ—Ä–¥ (`app/web/dashboard.py`)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–æ—Ç–∞ –≤ —É–¥–æ–±–Ω–æ–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, –ø–ª–∞—Ç–µ–∂–∞—Ö, –ø–æ–¥–ø–∏—Å–∫–∞—Ö
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç winback-—Å–æ–æ–±—â–µ–Ω–∏—è –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–°—Ç—Ä–∞–Ω–∏—Ü—ã:**
- `/` - –ì–ª–∞–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- `/users` - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å winback-—Å—Ç–∞—Ç—É—Å–æ–º
- `/payments` - –°–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π
- `/subscriptions` - –°–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏
- `/api/stats` - JSON API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω (Bootstrap 5)
- –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- –°—Å—ã–ª–∫–∏ –Ω–∞ Telegram –ø—Ä–æ—Ñ–∏–ª–∏

## –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ worker'–∞ (–≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏)
python -m app.tasks.worker

# –ó–∞–ø—É—Å–∫ –≤–µ–±-–¥–∞—à–±–æ—Ä–¥–∞
python -m app.web.dashboard

# –¢–æ–ª—å–∫–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
python -m app.tasks.reminders

# –¢–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
python -m app.tasks.expiry

# –¢–æ–ª—å–∫–æ winback (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
python -m app.tasks.winback
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

- `CHECK_INTERVAL = 60` - –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
- `CHANNEL_ID` - ID –∫–∞–Ω–∞–ª–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

### 4. Winback-—Å–æ–æ–±—â–µ–Ω–∏—è (`app/tasks/winback.py`)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å, –Ω–æ –Ω–µ —Å–æ–≤–µ—Ä—à–∏–ª–∏ –æ–ø–ª–∞—Ç—É
- Winback —á–µ—Ä–µ–∑ 3 –¥–Ω—è, 7 –¥–Ω–µ–π –∏ 30 –¥–Ω–µ–π –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–Ω—Ç–µ–Ω—Ç–µ –∏ –∫–Ω–æ–ø–∫–∞–º–∏ —Ç–∞—Ä–∏—Ñ–æ–≤

**–õ–æ–≥–∏–∫–∞ winback:**
```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ —É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
# Winback 3d: —á–µ—Ä–µ–∑ 3 –¥–Ω—è –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
# Winback 7d: —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ 3d)
# Winback 30d: —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ 7d)
```

**–°–æ–æ–±—â–µ–Ω–∏–µ:**
- –§–æ—Ç–æ: `app/assets/IMG_0796.PNG`
- –¢–µ–∫—Å—Ç: "–©–æ –≤–∞—Å —á–µ–∫–∞—î —É –≤–µ—Ä–µ—Å–Ω—ñüçÇ" + —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ + "–û–±–∏—Ä–∞–π —Ç–∞—Ä–∏—Ñ —Ç–∞ –ø—Ä–∏—î–¥–Ω—É–π—Å—èüñ§"
- –ö–Ω–æ–ø–∫–∏: —Ç–∞—Ä–∏—Ñ—ã 1–º, 2–º, 3–º

**–õ–æ–≥–∏:**
- `[WINBACK] –ü—Ä–æ–≤–µ—Ä–∫–∞ winback-—Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ {–≤—Ä–µ–º—è}`
- `[WINBACK] –ù–∞–π–¥–µ–Ω–æ {–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –æ–ø–ª–∞—Ç—ã`
- `[WINBACK] –ù–∞–π–¥–µ–Ω–æ {–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è winback —á–µ—Ä–µ–∑ 3/7/30 –¥–Ω–µ–π`
- `[WINBACK] Winback-—Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {tg_id}`
- `[WINBACK] Winback 3d/7d/30d –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {tg_id}`

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–±—Ä–∞–Ω–æ** - –ª–æ–≥–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–ø–∏—Å–∫–∞—Ö –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –∏–∑ reminders.py –≤ expiry.py
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ [EXPIRY], [REMINDERS], [WORKER], [WINBACK]
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –≤—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Ä–∞–±–æ—Ç—É —Ü–∏–∫–ª–æ–≤
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ ban/unban, —á—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Telegram API
5. **Winback-—Å–∏—Å—Ç–µ–º–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–µ–∑ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ 3, 7 –∏ 30 –¥–Ω–µ–π
6. **–í–µ–±-–¥–∞—à–±–æ—Ä–¥** - —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
